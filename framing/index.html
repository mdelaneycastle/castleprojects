<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frames & Slips | Gallery Reference Guide</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-card: #141414;
            --bg-card-hover: #1a1a1a;
            --text-primary: #f5f0e8;
            --text-secondary: #a09a90;
            --accent-gold: #c9a962;
            --accent-gold-dim: #8a7544;
            --border-subtle: rgba(201, 169, 98, 0.15);
            --border-hover: rgba(201, 169, 98, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Subtle noise texture overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            z-index: 1000;
        }

        /* Header */
        header {
            padding: 3rem 2rem;
            text-align: center;
            border-bottom: 1px solid var(--border-subtle);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(201, 169, 98, 0.08) 0%, transparent 70%);
            pointer-events: none;
        }

        .logo-text {
            font-family: 'Cormorant Garamond', serif;
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 300;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .logo-text span {
            color: var(--accent-gold);
            font-style: italic;
            font-weight: 400;
        }

        .tagline {
            font-size: 0.85rem;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            color: var(--text-secondary);
        }

        /* Filter Bar */
        .filter-bar {
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            border-bottom: 1px solid var(--border-subtle);
            background: rgba(20, 20, 20, 0.5);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .filter-btn {
            padding: 0.6rem 1.4rem;
            background: transparent;
            border: 1px solid var(--border-subtle);
            color: var(--text-secondary);
            font-family: 'DM Sans', sans-serif;
            font-size: 0.8rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn:hover,
        .filter-btn.active {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
            background: rgba(201, 169, 98, 0.05);
        }

        /* Search */
        .search-container {
            padding: 2rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            color: var(--text-primary);
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .search-input::placeholder {
            color: var(--text-secondary);
        }

        .search-input:focus {
            border-color: var(--accent-gold);
        }

        /* Main Grid */
        main {
            padding: 2rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        .frames-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 2rem;
        }

        /* Frame Card */
        .frame-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 0.6s ease forwards;
        }

        .frame-card:hover {
            border-color: var(--border-hover);
            transform: translateY(-4px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4),
                        0 0 0 1px rgba(201, 169, 98, 0.1);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .frame-card:nth-child(1) { animation-delay: 0.1s; }
        .frame-card:nth-child(2) { animation-delay: 0.15s; }
        .frame-card:nth-child(3) { animation-delay: 0.2s; }
        .frame-card:nth-child(4) { animation-delay: 0.25s; }
        .frame-card:nth-child(5) { animation-delay: 0.3s; }
        .frame-card:nth-child(6) { animation-delay: 0.35s; }

        .frame-image-container {
            position: relative;
            height: 280px;
            background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .frame-image-container::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(ellipse at center, rgba(201, 169, 98, 0.03) 0%, transparent 70%);
        }

        .frame-image {
            max-width: 85%;
            max-height: 85%;
            object-fit: contain;
            transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.5));
        }

        .frame-card:hover .frame-image {
            transform: scale(1.05);
        }

        .frame-code-badge {
            position: absolute;
            top: 1rem;
            left: 1rem;
            z-index: 10;
            background: rgba(10, 10, 10, 0.95);
            border: 1px solid var(--accent-gold-dim);
            padding: 0.4rem 0.8rem;
            font-family: 'DM Sans', sans-serif;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            color: var(--accent-gold);
        }

        .supplier-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 10;
            background: rgba(10, 10, 10, 0.95);
            padding: 0.3rem 0.6rem;
            font-family: 'DM Sans', sans-serif;
            font-size: 0.65rem;
            font-weight: 500;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .larson-supplier .supplier-badge {
            border: 1px solid var(--accent-gold-dim);
            color: var(--accent-gold);
        }

        .lion-supplier .supplier-badge {
            border: 1px solid #6b8e7b;
            color: #8fb89f;
        }

        .lion-supplier .frame-code-badge {
            border-color: #6b8e7b;
            color: #8fb89f;
        }

        .lion-supplier:hover {
            border-color: rgba(107, 142, 123, 0.4);
        }

        .lion-supplier .frame-link {
            border-color: #6b8e7b;
            color: #8fb89f;
        }

        .lion-supplier .frame-link:hover {
            background: #8fb89f;
            color: var(--bg-primary);
        }

        .frame-content {
            padding: 1.5rem;
        }

        .frame-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            font-weight: 400;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        .frame-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.7;
        }

        .frame-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .meta-tag {
            padding: 0.3rem 0.7rem;
            background: rgba(201, 169, 98, 0.1);
            border: 1px solid var(--border-subtle);
            font-size: 0.7rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: var(--accent-gold);
        }

        .frame-alternatives {
            font-size: 0.8rem;
            color: var(--text-secondary);
            padding-top: 1rem;
            border-top: 1px solid var(--border-subtle);
        }

        .frame-alternatives strong {
            color: var(--text-primary);
            font-weight: 500;
        }

        .frame-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            padding: 0.7rem 1.2rem;
            background: transparent;
            border: 1px solid var(--accent-gold-dim);
            color: var(--accent-gold);
            text-decoration: none;
            font-size: 0.8rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            transition: all 0.3s ease;
        }

        .frame-link:hover {
            background: var(--accent-gold);
            color: var(--bg-primary);
        }

        .frame-link svg {
            width: 14px;
            height: 14px;
            transition: transform 0.3s ease;
        }

        .frame-link:hover svg {
            transform: translateX(3px);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 3rem 2rem;
            border-top: 1px solid var(--border-subtle);
            margin-top: 4rem;
        }

        .footer-text {
            font-size: 0.8rem;
            color: var(--text-secondary);
            letter-spacing: 0.1em;
        }

        /* No results */
        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            font-style: italic;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .frames-grid {
                grid-template-columns: 1fr;
            }

            header {
                padding: 2rem 1rem;
            }

            main {
                padding: 1rem;
            }
        }

        /* Calculator Styles */
        .sub-filter {
            border-top: none;
            padding-top: 0.75rem;
            background: rgba(15, 15, 15, 0.5);
        }

        .view-btn.active {
            background: rgba(201, 169, 98, 0.15);
        }

        .calculator-section {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .calculator-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .calc-panel {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 2rem;
            animation: fadeInUp 0.6s ease forwards;
        }

        .calc-panel.total-panel {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, rgba(201, 169, 98, 0.08) 0%, var(--bg-card) 100%);
        }

        .calc-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.6rem;
            font-weight: 400;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .calc-subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .calc-row {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .calc-group {
            flex: 1;
        }

        .calc-group.full-width {
            flex: none;
            width: 100%;
        }

        .calc-group.band-display {
            flex: 0 0 120px;
        }

        .calc-label {
            display: block;
            font-size: 0.75rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .calc-input,
        .calc-select {
            width: 100%;
            padding: 0.9rem 1rem;
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            color: var(--text-primary);
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .calc-input:focus,
        .calc-select:focus {
            border-color: var(--accent-gold);
        }

        .calc-select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a09a90' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            padding-right: 2.5rem;
        }

        .calc-select option {
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .band-value {
            padding: 0.9rem 1rem;
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            font-size: 1.4rem;
            font-weight: 600;
            text-align: center;
            color: var(--accent-gold);
        }

        .toggle-group {
            display: flex;
            gap: 0;
        }

        .toggle-btn {
            flex: 1;
            padding: 0.9rem 1rem;
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            color: var(--text-secondary);
            font-family: 'DM Sans', sans-serif;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-btn:first-child {
            border-right: none;
        }

        .toggle-btn.active {
            background: rgba(201, 169, 98, 0.15);
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        .toggle-btn:hover:not(.active) {
            border-color: var(--border-hover);
            color: var(--text-primary);
        }

        .calc-divider {
            height: 1px;
            background: var(--border-subtle);
            margin: 1.5rem 0;
        }

        .calc-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-label {
            font-size: 0.85rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--text-secondary);
        }

        .result-value {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.2rem;
            font-weight: 600;
            color: var(--accent-gold);
        }

        .glass-info {
            background: rgba(201, 169, 98, 0.05);
            border: 1px solid var(--border-subtle);
            padding: 1rem;
            margin-top: 1rem;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .info-row span:last-child {
            color: var(--text-primary);
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            font-size: 1rem;
            color: var(--text-secondary);
        }

        .total-row span:last-child {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            color: var(--text-primary);
        }

        .total-row.grand-total {
            padding-top: 1rem;
        }

        .total-row.grand-total span:first-child {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .total-row.grand-total span:last-child {
            font-size: 2.4rem;
            font-weight: 600;
            color: var(--accent-gold);
        }

        .reset-btn {
            width: 100%;
            margin-top: 1.5rem;
            padding: 1rem;
            background: transparent;
            border: 1px solid var(--border-subtle);
            color: var(--text-secondary);
            font-family: 'DM Sans', sans-serif;
            font-size: 0.85rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reset-btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        .btn-row {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn-row .reset-btn {
            margin-top: 0;
            flex: 1;
        }

        .export-btn {
            flex: 1;
            padding: 1rem;
            background: var(--accent-gold);
            border: 1px solid var(--accent-gold);
            color: var(--bg-primary);
            font-family: 'DM Sans', sans-serif;
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: transparent;
            color: var(--accent-gold);
        }

        /* Admin Styles */
        .admin-btn {
            margin-left: auto;
            opacity: 0.6;
        }

        .admin-btn:hover {
            opacity: 1;
        }

        .admin-section {
            padding: 2rem;
            max-width: 1100px;
            margin: 0 auto;
        }

        .admin-login {
            display: flex;
            justify-content: center;
            padding-top: 3rem;
        }

        .login-panel {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            padding: 2rem;
            width: 100%;
            max-width: 400px;
        }

        .login-error {
            color: #e57373;
            font-size: 0.85rem;
            margin-top: 1rem;
            text-align: center;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .stock-list {
            margin-top: 2rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .stock-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.25rem;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            transition: all 0.2s ease;
        }

        .stock-item:hover {
            border-color: var(--border-hover);
        }

        .stock-item.out-of-stock {
            border-color: #e57373;
            background: rgba(229, 115, 115, 0.05);
        }

        .stock-item-image {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%);
            border: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            overflow: hidden;
        }

        .stock-item-image img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }

        .stock-item-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            flex: 1;
        }

        .stock-item-code {
            font-weight: 600;
            color: var(--accent-gold);
            font-size: 0.9rem;
        }

        .stock-item-title {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .stock-item-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stock-toggle {
            position: relative;
            width: 50px;
            height: 26px;
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .stock-toggle::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 18px;
            height: 18px;
            background: var(--text-secondary);
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .stock-toggle.in-stock {
            background: rgba(129, 199, 132, 0.2);
            border-color: #81c784;
        }

        .stock-toggle.in-stock::after {
            left: 27px;
            background: #81c784;
        }

        .stock-toggle.out-of-stock {
            background: rgba(229, 115, 115, 0.2);
            border-color: #e57373;
        }

        .stock-toggle.out-of-stock::after {
            background: #e57373;
        }

        /* Out of stock badge on frame cards */
        .out-of-stock-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 10;
            background: rgba(229, 115, 115, 0.95);
            padding: 0.3rem 0.6rem;
            font-size: 0.65rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: #fff;
        }

        .frame-card.is-out-of-stock {
            opacity: 0.6;
        }

        .frame-card.is-out-of-stock:hover {
            opacity: 0.8;
        }

        .backup-badge {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            z-index: 10;
            background: rgba(129, 199, 132, 0.95);
            padding: 0.3rem 0.6rem;
            font-size: 0.65rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: #1a1a1a;
        }

        .slip-badge {
            position: absolute;
            bottom: 1rem;
            left: 1rem;
            z-index: 10;
            background: rgba(156, 136, 255, 0.95);
            padding: 0.3rem 0.6rem;
            font-size: 0.65rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: #fff;
        }

        /* Slip filter styling */
        .filter-btn[data-filter="slip"] {
            border-color: rgba(156, 136, 255, 0.4);
            color: #b8a8ff;
        }

        .filter-btn[data-filter="slip"]:hover,
        .filter-btn[data-filter="slip"].active {
            border-color: #9c88ff;
            color: #9c88ff;
            background: rgba(156, 136, 255, 0.1);
        }

        /* Restock date styling */
        .restock-date-container {
            display: none;
            align-items: center;
            gap: 0.5rem;
        }

        .restock-date-container.visible {
            display: flex;
        }

        .restock-input {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
            pointer-events: none;
        }

        .calendar-btn {
            width: 36px;
            height: 36px;
            background: var(--bg-primary);
            border: 1px solid var(--border-subtle);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .calendar-btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        .calendar-btn svg {
            width: 18px;
            height: 18px;
        }

        .restock-badge {
            font-size: 0.75rem;
            color: #ffb74d;
            white-space: nowrap;
        }

        .clear-date-btn {
            width: 24px;
            height: 24px;
            background: transparent;
            border: 1px solid var(--border-subtle);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            line-height: 1;
            transition: all 0.3s ease;
        }

        .clear-date-btn:hover {
            border-color: #e57373;
            color: #e57373;
        }

        .out-of-stock-restock {
            font-size: 0.6rem;
            color: #ffb74d;
            margin-top: 0.25rem;
            display: block;
        }

        /* Admin search */
        .admin-search-container {
            margin-bottom: 1.5rem;
        }

        .admin-search-input {
            width: 100%;
            padding: 1rem 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            color: var(--text-primary);
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .admin-search-input::placeholder {
            color: var(--text-secondary);
        }

        .admin-search-input:focus {
            border-color: var(--accent-gold);
        }

        @media (max-width: 900px) {
            .calculator-container {
                grid-template-columns: 1fr;
            }

            .calc-panel.total-panel {
                grid-column: auto;
            }

            .calc-row {
                flex-direction: column;
                gap: 1rem;
            }

            .calc-group.band-display {
                flex: 1;
            }

            .stock-item {
                flex-wrap: wrap;
            }

            .stock-item-controls {
                width: 100%;
                justify-content: space-between;
                margin-top: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Hidden logo for PDF export -->
    <img id="pdfLogo" src="castle-logo.png" alt="" style="display:none;" crossorigin="anonymous">

    <header>
        <h1 class="logo-text">Frames <span>&</span> Slips</h1>
        <p class="tagline">Gallery Reference Guide</p>
    </header>

    <nav class="filter-bar">
        <button class="filter-btn view-btn active" data-view="frames">Frame Catalogue</button>
        <button class="filter-btn view-btn" data-view="calculator">Price Calculator</button>
        <button class="filter-btn view-btn admin-btn" data-view="admin">Admin</button>
    </nav>

    <nav class="filter-bar sub-filter" id="frameFilters">
        <button class="filter-btn active" data-filter="all">All Frames</button>
        <button class="filter-btn" data-filter="larson">Larson Juhl</button>
        <button class="filter-btn" data-filter="lion">Lion</button>
        <button class="filter-btn" data-filter="slip">Slips</button>
    </nav>

    <div class="search-container" id="searchContainer">
        <input type="text" class="search-input" placeholder="Search by code, description, or usage..." id="searchInput">
    </div>

    <!-- Calculator Section -->
    <section class="calculator-section" id="calculatorSection" style="display: none;">
        <div class="calculator-container">
            <div class="calc-panel">
                <h2 class="calc-title">Frame Price Calculator</h2>

                <div class="calc-row">
                    <div class="calc-group">
                        <label class="calc-label">Frame Code</label>
                        <select id="frameSelect" class="calc-select">
                            <option value="">Select a frame...</option>
                        </select>
                    </div>
                    <div class="calc-group band-display">
                        <label class="calc-label">Price Band</label>
                        <div class="band-value" id="bandDisplay">-</div>
                    </div>
                </div>

                <div class="calc-row">
                    <div class="calc-group">
                        <label class="calc-label">Length (cm)</label>
                        <input type="number" id="lengthInput" class="calc-input" placeholder="e.g. 65" min="1" step="0.1">
                    </div>
                    <div class="calc-group">
                        <label class="calc-label">Width (cm)</label>
                        <input type="number" id="widthInput" class="calc-input" placeholder="e.g. 70" min="1" step="0.1">
                    </div>
                </div>

                <div class="calc-row">
                    <div class="calc-group">
                        <label class="calc-label">Include Glass/Perspex?</label>
                        <div class="toggle-group">
                            <button class="toggle-btn active" data-glass="no">No Glass</button>
                            <button class="toggle-btn" data-glass="yes">With Glass (+£50)</button>
                        </div>
                    </div>
                </div>

                <div class="calc-divider"></div>

                <div class="calc-result">
                    <div class="result-label">Frame Price</div>
                    <div class="result-value" id="framePrice">£0.00</div>
                </div>
            </div>

            <div class="calc-panel">
                <h2 class="calc-title">Glazing Upgrade Calculator</h2>
                <p class="calc-subtitle">Calculate additional cost for premium glazing options</p>

                <div class="calc-row">
                    <div class="calc-group">
                        <label class="calc-label">Height (cm)</label>
                        <input type="number" id="glassHeight" class="calc-input" placeholder="e.g. 86.5" min="1" step="0.1">
                    </div>
                    <div class="calc-group">
                        <label class="calc-label">Width (cm)</label>
                        <input type="number" id="glassWidth" class="calc-input" placeholder="e.g. 64.5" min="1" step="0.1">
                    </div>
                </div>

                <div class="calc-row">
                    <div class="calc-group full-width">
                        <label class="calc-label">Glass Type</label>
                        <select id="glassType" class="calc-select">
                            <option value="0">Standard Glass (included)</option>
                            <option value="0.02">UV AR/70 - £0.02/cm² (98% UV protection)</option>
                            <option value="0.028">UV AR/99 Museum Glass - £0.028/cm² (best quality)</option>
                            <option value="0.05">Museum Acrylic - £0.05/cm² (for overseas shipping)</option>
                        </select>
                    </div>
                </div>

                <div class="glass-info">
                    <div class="info-row"><span>Area:</span> <span id="glassArea">0 cm²</span></div>
                </div>

                <div class="calc-divider"></div>

                <div class="calc-result">
                    <div class="result-label">Glazing Upgrade Cost</div>
                    <div class="result-value" id="glassPrice">£0.00</div>
                </div>
            </div>

            <div class="calc-panel total-panel">
                <div class="total-row">
                    <span>Frame Price:</span>
                    <span id="totalFrame">£0.00</span>
                </div>
                <div class="total-row">
                    <span>Glazing Upgrade:</span>
                    <span id="totalGlass">£0.00</span>
                </div>
                <div class="calc-divider"></div>
                <div class="total-row grand-total">
                    <span>Total Quote:</span>
                    <span id="grandTotal">£0.00</span>
                </div>
                <div class="btn-row">
                    <button class="reset-btn" id="resetCalc">Reset Calculator</button>
                    <button class="export-btn" id="exportPdf">Export Quote PDF</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Admin Section -->
    <section class="admin-section" id="adminSection" style="display: none;">
        <div class="admin-container">
            <!-- Password Gate -->
            <div class="admin-login" id="adminLogin">
                <div class="login-panel">
                    <h2 class="calc-title">Admin Access</h2>
                    <p class="calc-subtitle">Enter password to manage stock levels</p>
                    <div class="calc-group">
                        <input type="password" id="adminPassword" class="calc-input" placeholder="Enter password">
                    </div>
                    <button class="export-btn" id="adminLoginBtn" style="margin-top: 1rem;">Login</button>
                    <p class="login-error" id="loginError" style="display: none;">Incorrect password</p>
                </div>
            </div>

            <!-- Admin Panel (shown after login) -->
            <div class="admin-panel" id="adminPanel" style="display: none;">
                <div class="admin-header">
                    <h2 class="calc-title">Stock Management</h2>
                    <button class="reset-btn" id="adminLogout" style="width: auto; padding: 0.5rem 1rem;">Logout</button>
                </div>
                <p class="calc-subtitle">Mark frames as out of stock. When a frame is out of stock, its backup alternatives will appear in the catalogue.</p>

                <div class="admin-search-container">
                    <input type="text" class="admin-search-input" placeholder="Search by code, name, or description..." id="adminSearchInput">
                </div>

                <div class="stock-list" id="stockList">
                    <!-- Stock items will be inserted here -->
                </div>
            </div>
        </div>
    </section>

    <main id="framesSection">
        <div class="frames-grid" id="framesGrid">
            <!-- Frame cards will be inserted here by JavaScript -->
        </div>
    </main>

    <footer>
        <p class="footer-text">Standard Frames, Slips & Alternative Options</p>
    </footer>

    <script>
        // Price band mapping from spreadsheet
        const priceBands = {
            // Band A
            "617348000": "A", "431434": "A", "350790": "A", "350792": "A",
            "266412626": "A", "266412727": "A", "265411727": "A", "337167000": "A",
            "432167246": "A", "432167348": "A", "441227000": "A", "440227000": "A",
            "532167000": "A", "734146000": "A", "734148000": "A", "216167000": "A",
            "219000178": "A", "241000107": "A", "241000167": "A", "277501653": "A",
            "277501673": "A", "277501753": "A", "277501773": "A", "342703001": "A",
            "411167003": "A", "411167007": "A", "415220167": "A", "431167000": "A",
            "432167000": "A", "L3135": "A",
            // Band B
            "756287000": "B", "739287000": "B", "791287000": "B", "549650": "B",
            "536560": "B", "283502653": "B", "283502673": "B", "283502753": "B",
            "283502773": "B", "513287000": "B", "737075000": "B", "737077000": "B",
            "737079000": "B", "L2789": "B", "L2716": "B", "L2947": "B", "L2948": "B",
            // Band C
            "407000127": "C", "407000167": "C", "513167000": "C", "508167000": "C",
            "601167000": "C", "639167000": "C", "517167000": "C", "L3072": "C"
        };

        const framesData = [
            {
                code: "617348000",
                title: "Champagne Mottled",
                description: "Mottled finish with brown/copper flecks running through the paint work, giving a champagne hue. Each stick will be slightly different as they are hand finished.",
                usedOn: ["BDY", "SRA"],
                alternative: "Contact coordinator for selection",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-617348000",
                supplier: "larson"
            },
            {
                code: "431434",
                title: "Black Satin Zen",
                description: "Black, satin finish.",
                usedOn: ["BDY", "MONDO", "WHN"],
                alternative: "L3135 / 431167000 (dark slate grey, identical profile)",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-signature/ljs-zen-moulding-pefc-431434",
                supplier: "larson"
            },
            {
                code: "350790",
                title: "Lucerne Woodgrain",
                description: "Brown/black woodgrain border with painted silver inner step.",
                usedOn: ["BCN", "RWO"],
                alternative: "650790 / 350792",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-signature/ljs-lucerne-moulding-pefc-350790",
                supplier: "larson"
            },
            {
                code: "756287000",
                title: "Textured Brown/Black",
                description: "Mottled brown/black textured finish.",
                usedOn: ["BBA", "JJO", "NMA"],
                alternative: "739287000 / 791287000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-756287000",
                supplier: "larson"
            },
            {
                code: "532167000",
                title: "Mono Float Black",
                description: "Black, satin finish with floated-look step border.",
                usedOn: ["JJO", "PAPER"],
                alternative: "337167000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-collections/ljc-mono-moulding-532167000",
                supplier: "larson"
            },
            {
                code: "549650",
                title: "Tate",
                description: "Classic profile from the Signature collection.",
                usedOn: ["PKE", "RBR"],
                alternative: "536560",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-signature/ljs-tate-moulding-549650",
                supplier: "larson"
            },
            {
                code: "266412727",
                title: "Provence Ornate",
                description: "Elegant ornate profile from the Collections range.",
                usedOn: ["LCO"],
                alternative: "265411727",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-collections/ljc-provence-moulding-fsc-266412727",
                supplier: "larson"
            },
            {
                code: "266412626",
                title: "Provence Classic",
                description: "Classic ornate profile from the Collections range.",
                usedOn: ["LCO"],
                alternative: "283502653",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-collections/ljc-provence-moulding-fsc-266412626",
                supplier: "larson"
            },
            {
                code: "432167246",
                title: "Urbane Natural",
                description: "Contemporary urbane profile.",
                usedOn: ["NHU"],
                alternative: "L2948",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-collections/ljc-urbane-moulding-432167246",
                supplier: "larson"
            },
            {
                code: "432167348",
                title: "Urbane Dark",
                description: "Contemporary urbane profile in darker finish.",
                usedOn: ["NHU"],
                alternative: "L2947",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-collections/ljc-urbane-moulding-432167348",
                supplier: "larson"
            },
            {
                code: "283502753",
                title: "Andover Gold",
                description: "Classic Andover profile in gold finish.",
                usedOn: ["PCO"],
                alternative: "277501753",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-collections/ljc-andover-moulding-fsc-283502753",
                supplier: "larson"
            },
            {
                code: "283502773",
                title: "Andover Silver",
                description: "Classic Andover profile in silver finish.",
                usedOn: ["PCO"],
                alternative: "277501773",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-collections/ljc-andover-moulding-fsc-283502773",
                supplier: "larson"
            },
            {
                code: "283502673",
                title: "Andover Bronze",
                description: "Classic Andover profile in bronze finish.",
                usedOn: ["PCO"],
                alternative: "277501673",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-collections/ljc-andover-moulding-fsc-283502673",
                supplier: "larson"
            },
            {
                code: "283502653",
                title: "Andover Copper",
                description: "Classic Andover profile in copper finish.",
                usedOn: ["PCO"],
                alternative: "277501653",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-collections/ljc-andover-moulding-fsc-283502653",
                supplier: "larson"
            },
            {
                code: "601167000",
                title: "Essentials Black",
                description: "Essential black profile, versatile for multiple uses.",
                usedOn: ["PSM", "DLN", "SMM"],
                alternative: "216167000 / 432167000 / 241000167",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-601167000",
                supplier: "larson"
            },
            {
                code: "734146000",
                title: "Essentials Natural",
                description: "Natural wood finish from Essentials range.",
                usedOn: ["PSM"],
                alternative: "734148000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-734146000",
                supplier: "larson"
            },
            {
                code: "737077000",
                title: "Essentials Oak",
                description: "Oak finish from Essentials range.",
                usedOn: ["PSM", "XWA"],
                alternative: "737079000 / 737075000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-collections/lje-moulding-737077000",
                supplier: "larson"
            },
            {
                code: "337167000",
                title: "Essentials Slate",
                description: "Slate black finish from Essentials range.",
                usedOn: ["RRO"],
                alternative: "517167000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-337167000",
                supplier: "larson"
            },
            {
                code: "441227000",
                title: "Essentials White",
                description: "Clean white finish from Essentials range.",
                usedOn: [],
                alternative: "440227000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-441227000",
                supplier: "larson"
            },
            {
                code: "513167000",
                title: "Collections Black",
                description: "Black profile from Collections range.",
                usedOn: [],
                alternative: "508167000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-collections/ljc-moulding-513167000",
                supplier: "larson"
            },
            {
                code: "415220167",
                title: "Box Canvas",
                description: "Black high gloss float moulding for canvas work.",
                usedOn: ["STL", "RBR"],
                alternative: "",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-float-moulding-415220167",
                supplier: "larson"
            },
            {
                code: "216167000",
                title: "Essentials Profile",
                description: "Versatile essential profile for multiple uses.",
                usedOn: ["PSM", "DLN", "SMM"],
                alternative: "432167000 / 241000167",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-216167000",
                supplier: "larson"
            },
            {
                code: "241000107",
                title: "Coastal Woods Natural",
                description: "Natural finish from Coastal Woods collection.",
                usedOn: [],
                alternative: "",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-collections/ljc-coastal-woods-moulding-241000107",
                supplier: "larson",
                backupOnly: true
            },
            {
                code: "241000167",
                title: "Coastal Woods Dark",
                description: "Dark finish from Coastal Woods collection.",
                usedOn: ["PSM", "DLN", "SMM"],
                alternative: "216167000 / 432167000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-241000167",
                supplier: "larson"
            },
            {
                code: "265411727",
                title: "Provence Alternative",
                description: "Elegant ornate profile with gold accents.",
                usedOn: ["LCO"],
                alternative: "266412727",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-265411727",
                supplier: "larson",
                backupOnly: true
            },
            {
                code: "277501653",
                title: "Andover Copper Alt",
                description: "Alternative Andover profile with silver accents.",
                usedOn: ["PCO"],
                alternative: "283502653",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-277501653",
                supplier: "larson",
                backupOnly: true
            },
            {
                code: "277501753",
                title: "Andover Gold Alt",
                description: "Alternative Andover profile with gold accents.",
                usedOn: ["PCO"],
                alternative: "283502753",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-277501753",
                supplier: "larson",
                backupOnly: true
            },
            {
                code: "277501773",
                title: "Andover Silver Alt",
                description: "Alternative Andover profile in silver finish.",
                usedOn: ["PCO"],
                alternative: "283502773",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-277501773",
                supplier: "larson",
                backupOnly: true
            },
            {
                code: "342703001",
                title: "Heritage Profile",
                description: "Classic heritage frame profile.",
                usedOn: ["NHU"],
                alternative: "",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-342703001",
                supplier: "larson",
                isSlip: true
            },
            {
                code: "350792",
                title: "Lucerne Silver",
                description: "Lucerne profile with silver accents.",
                usedOn: ["BCN", "RWO"],
                alternative: "650790 / 350790",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-350792",
                supplier: "larson",
                backupOnly: true
            },
            {
                code: "407000127",
                title: "Coastal Woods Float White",
                description: "White finish float moulding from Coastal Woods.",
                usedOn: ["SRA"],
                alternative: "L3072",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-collections/ljc-coastal-woods-float-moulding-407000127",
                supplier: "larson"
            },
            {
                code: "407000167",
                title: "Essentials Black Satin",
                description: "Black satin finish essential profile.",
                usedOn: ["PKE"],
                alternative: "",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-407000167",
                supplier: "larson"
            },
            {
                code: "411167003",
                title: "Caserta Light",
                description: "Light finish from Caserta collection.",
                usedOn: ["PKE"],
                alternative: "",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-collections/ljc-caserta-moulding-pefc-411167003",
                supplier: "larson",
                isSlip: true
            },
            {
                code: "411167007",
                title: "Caserta Dark",
                description: "Dark finish from Caserta collection.",
                usedOn: ["PKE"],
                alternative: "",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-collections/ljc-caserta-moulding-pefc-411167007",
                supplier: "larson",
                isSlip: true
            },
            {
                code: "431167000",
                title: "Zen Slate Grey",
                description: "Dark slate grey with identical profile to 431434.",
                usedOn: ["BDY", "MONDO", "WHN"],
                alternative: "431434 / L3135",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-signature/ljs-zen-moulding-431167000",
                supplier: "larson"
            },
            {
                code: "432167000",
                title: "Urbane Black",
                description: "Contemporary urbane profile in black.",
                usedOn: ["PSM", "DLN", "SMM"],
                alternative: "216167000 / 241000167",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-432167000",
                supplier: "larson",
                backupOnly: true
            },
            {
                code: "440227000",
                title: "Essentials White Alt",
                description: "Alternative white finish from Essentials range.",
                usedOn: [],
                alternative: "441227000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-440227000",
                supplier: "larson"
            },
            {
                code: "508167000",
                title: "Essentials Black Profile",
                description: "Black satin finish profile.",
                usedOn: ["MAZ", "RHM"],
                alternative: "639167000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-508167000",
                supplier: "larson"
            },
            {
                code: "513287000",
                title: "Float Moulding Textured",
                description: "Mottled textured finish float moulding for canvas.",
                usedOn: ["BBA", "BOX", "CANVAS"],
                alternative: "513167000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-float-moulding-513287000",
                supplier: "larson"
            },
            {
                code: "517167000",
                title: "Essentials Slate Alt",
                description: "Alternative slate finish from Essentials range.",
                usedOn: ["RRO"],
                alternative: "337167000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-517167000",
                supplier: "larson"
            },
            {
                code: "639167000",
                title: "Essentials Black Wide",
                description: "Black satin finish wide profile.",
                usedOn: ["MAZ", "RHM"],
                alternative: "508167000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-639167000",
                supplier: "larson"
            },
            {
                code: "650790",
                title: "Lucerne Gold",
                description: "Lucerne profile with silver/gold accents.",
                usedOn: ["BCN", "RWO"],
                alternative: "350790 / 350792",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-650790",
                supplier: "larson",
                backupOnly: true
            },
            {
                code: "734148000",
                title: "Essentials Natural Alt",
                description: "Alternative natural wood finish.",
                usedOn: ["PSM"],
                alternative: "734146000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-734148000",
                supplier: "larson",
                backupOnly: true
            },
            {
                code: "737075000",
                title: "Essentials Oak Light",
                description: "Light oak finish from Essentials range.",
                usedOn: ["PSM", "XWA"],
                alternative: "737077000 / 737079000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-737075000",
                supplier: "larson"
            },
            {
                code: "737079000",
                title: "Essentials Oak Dark",
                description: "Dark oak finish from Essentials range.",
                usedOn: ["PSM", "XWA"],
                alternative: "737077000 / 737075000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-737079000",
                supplier: "larson"
            },
            {
                code: "739287000",
                title: "Textured Brown Alt",
                description: "Mottled brown/black textured finish alternative.",
                usedOn: ["BBA", "JJO", "NMA"],
                alternative: "756287000 / 791287000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-739287000",
                supplier: "larson"
            },
            {
                code: "791287000",
                title: "Textured Black Alt",
                description: "Mottled brown/black textured finish alternative.",
                usedOn: ["BBA", "JJO", "NMA"],
                alternative: "756287000 / 739287000",
                link: "https://larsonjuhl.co.uk/mouldings/larson-juhl-essentials/lje-moulding-791287000",
                supplier: "larson"
            },
            {
                code: "219000178",
                title: "Slip",
                description: "Custom slip especially made for Castle Fine Art.",
                usedOn: ["PCO", "BBA", "JJO"],
                alternative: "",
                link: "",
                supplier: "larson",
                image: "219000178.jpg",
                isSlip: true
            },
            // Lion Frames
            {
                code: "L1403",
                title: "Two Way Black Wash",
                description: "7mm Two Way Ls Black Wash FSC 100% Frame Moulding.",
                usedOn: [],
                alternative: "",
                link: "https://www.lionpic.co.uk/p/12649/7mm-Two-Way-Ls-Black-Wash-FSC-100-Frame-Moulding",
                supplier: "lion",
                image: "Two-Way-Frame-Moulding-Chevron-L1403-02.webp"
            },
            {
                code: "L2716",
                title: "Brompton Olive",
                description: "91mm Brompton Olive FSC Certified 100% Frame Moulding.",
                usedOn: [],
                alternative: "",
                link: "https://www.lionpic.co.uk/p/39549/91mm-Brompton-Olive-FSC-Certified-100-Frame-Moulding",
                supplier: "lion",
                image: "Brompton-Frame-Moulding-chevron-L2716-02.webp"
            },
            {
                code: "L2789",
                title: "Bloc L Style Black",
                description: "25mm Bloc L Style Black 48mm rebate Frame Moulding.",
                usedOn: [],
                alternative: "",
                link: "https://www.lionpic.co.uk/p/39698/25mm-Bloc-L-Style-Black-48mm-rebate-Frame-Moulding",
                supplier: "lion",
                image: "BLOC-Frame-Moulding-Chevron-L2789-01.webp"
            },
            {
                code: "L2947",
                title: "Vermeer Matt Black Silver",
                description: "65mm Vermeer Matt Black Silver Sight Edge FSC 100% Frame Moulding.",
                usedOn: ["NHU"],
                alternative: "432167348",
                link: "https://www.lionpic.co.uk/p/40420/65mm-Vermeer-Matt-Black-Silver-Sight-Edge-FSC-100-Frame-Moulding",
                supplier: "lion",
                image: "Vermeer-Frame-Moulding-Chevron-L2947-02.webp",
                backupOnly: true
            },
            {
                code: "L2948",
                title: "Vermeer Matt Black Gold",
                description: "65mm Vermeer Matt Black Gold Sight Edge FSC 100% Frame Moulding.",
                usedOn: ["NHU"],
                alternative: "432167246",
                link: "https://www.lionpic.co.uk/p/40423/65mm-Vermeer-Matt-Black-Gold-Sight-Edge-FSC-100-Frame-Moulding",
                supplier: "lion",
                image: "Vermeer-Frame-Moulding-Chevron-L2948-02.webp",
                backupOnly: true
            },
            {
                code: "L3072",
                title: "Bloc L Style White",
                description: "80mm Bloc L Style White Open Grain Frame Moulding.",
                usedOn: [],
                alternative: "",
                link: "https://www.lionpic.co.uk/p/41460/80mm-Bloc-L-Style-White-Open-Grain-Frame-Moulding",
                supplier: "lion",
                image: "BLOC-Frame-Moulding-Chevron-L3072-01.webp"
            },
            {
                code: "L3135",
                title: "Niro Black",
                description: "35mm x 50mm Niro Black FSC 100% Frame Moulding.",
                usedOn: [],
                alternative: "431434",
                link: "https://www.lionpic.co.uk/p/41778/35mm-x-50mm-Niro-Black-FSC-100-Frame-Moulding",
                supplier: "lion",
                image: "Niro-Frame-Moulding-Chevron-L3135-02.webp",
                backupOnly: true
            },
        ];

        // Stock management - must be defined before createFrameCard
        const ADMIN_PASSWORD = 'cfa2026';
        let stockStatus = JSON.parse(localStorage.getItem('frameStockStatus') || '{}');
        let restockDates = JSON.parse(localStorage.getItem('frameRestockDates') || '{}');

        function saveStockStatus() {
            localStorage.setItem('frameStockStatus', JSON.stringify(stockStatus));
        }

        function saveRestockDates() {
            localStorage.setItem('frameRestockDates', JSON.stringify(restockDates));
        }

        function isOutOfStock(code) {
            return stockStatus[code] === false;
        }

        function getRestockDate(code) {
            return restockDates[code] || '';
        }

        function setRestockDate(code, date) {
            if (date) {
                restockDates[code] = date;
            } else {
                delete restockDates[code];
            }
            saveRestockDates();
        }

        function formatRestockDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
        }

        function getAlternativeCodes(frame) {
            if (!frame.alternative) return [];
            return frame.alternative.split('/').map(s => s.trim()).filter(Boolean);
        }

        // Check if a backup frame should be shown (when its primary is out of stock)
        function shouldShowBackupFrame(frame) {
            if (!frame.backupOnly) return true;

            // Find frames that list this backup as an alternative
            for (const f of framesData) {
                if (f.backupOnly) continue;
                const altCodes = getAlternativeCodes(f);
                if (altCodes.includes(frame.code) && isOutOfStock(f.code)) {
                    return true;
                }
            }
            return false;
        }

        const arrowIcon = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>`;

        function createFrameCard(frame) {
            const usedOnTags = frame.usedOn.map(tag => `<span class="meta-tag">${tag}</span>`).join('');
            // Use custom image path for Lion, standard format for Larson
            const imageUrl = frame.image ? frame.image : `${frame.code}_4.jpg`;
            const supplierName = frame.supplier === 'lion' ? 'Lion' : 'Larson Juhl';
            const supplierClass = frame.supplier === 'lion' ? 'lion-supplier' : 'larson-supplier';
            const outOfStock = isOutOfStock(frame.code);
            const isBackup = frame.backupOnly;
            const isSlip = frame.isSlip;
            const restockDate = getRestockDate(frame.code);

            return `
                <article class="frame-card ${supplierClass} ${outOfStock ? 'is-out-of-stock' : ''}" data-supplier="${frame.supplier}" data-code="${frame.code}" data-used="${frame.usedOn.join(' ')}" data-desc="${frame.description}" data-slip="${isSlip ? 'true' : 'false'}">
                    <div class="frame-image-container">
                        <span class="frame-code-badge">${frame.code}</span>
                        ${outOfStock ? '<span class="out-of-stock-badge">Out of Stock</span>' : `<span class="supplier-badge">${supplierName}</span>`}
                        ${isBackup ? '<span class="backup-badge">Alternative</span>' : ''}
                        ${isSlip ? '<span class="slip-badge">Slip</span>' : ''}
                        <img src="${imageUrl}" alt="${frame.title}" class="frame-image" onerror="this.style.display='none'">
                    </div>
                    <div class="frame-content">
                        <h2 class="frame-title">${frame.title}</h2>
                        <p class="frame-description">${frame.description}</p>
                        ${outOfStock && restockDate ? `<span class="out-of-stock-restock">Est. restock: ${formatRestockDate(restockDate)}</span>` : ''}
                        ${usedOnTags ? `<div class="frame-meta">${usedOnTags}</div>` : ''}
                        ${frame.alternative ? `<p class="frame-alternatives"><strong>Alt:</strong> ${frame.alternative}</p>` : ''}
                        ${frame.link ? `<a href="${frame.link}" target="_blank" rel="noopener noreferrer" class="frame-link">
                            View on ${supplierName} ${arrowIcon}
                        </a>` : ''}
                    </div>
                </article>
            `;
        }

        function renderFrames(frames) {
            const grid = document.getElementById('framesGrid');
            if (!grid) return;

            // Filter frames: hide backupOnly unless primary is out of stock
            const visibleFrames = frames.filter(frame => shouldShowBackupFrame(frame));

            if (visibleFrames.length === 0) {
                grid.innerHTML = '<p class="no-results">No frames found matching your search.</p>';
                return;
            }
            grid.innerHTML = visibleFrames.map(createFrameCard).join('');
        }

        // Initial render
        renderFrames(framesData);

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        let searchQuery = '';

        searchInput.addEventListener('input', (e) => {
            searchQuery = e.target.value.toLowerCase();
            applyFiltersWithSearch();
        });

        function applyFiltersWithSearch() {
            let filtered = framesData;

            // Apply supplier/slip filter
            if (currentFilter !== 'all') {
                if (currentFilter === 'slip') {
                    filtered = filtered.filter(f => f.isSlip === true);
                } else {
                    filtered = filtered.filter(f => f.supplier === currentFilter);
                }
            }

            // Apply search filter
            if (searchQuery) {
                filtered = filtered.filter(frame =>
                    frame.code.toLowerCase().includes(searchQuery) ||
                    frame.title.toLowerCase().includes(searchQuery) ||
                    frame.description.toLowerCase().includes(searchQuery) ||
                    frame.usedOn.some(tag => tag.toLowerCase().includes(searchQuery)) ||
                    frame.alternative.toLowerCase().includes(searchQuery)
                );
            }

            renderFrames(filtered);
        }

        function applyFilters() {
            applyFiltersWithSearch();
        }

        // Filter buttons
        let currentFilter = 'all';

        document.querySelectorAll('#frameFilters .filter-btn').forEach(btn => {
            if (!btn || !btn.dataset) return;
            btn.addEventListener('click', () => {
                document.querySelectorAll('#frameFilters .filter-btn').forEach(b => {
                    if (b) b.classList.remove('active');
                });
                btn.classList.add('active');

                currentFilter = btn.dataset.filter;
                if (!currentFilter) return;
                applyFilters();
            });
        });

        // View switching (Frames vs Calculator vs Admin)
        const framesSection = document.getElementById('framesSection');
        const calculatorSection = document.getElementById('calculatorSection');
        const adminSection = document.getElementById('adminSection');
        const searchContainer = document.getElementById('searchContainer');
        const frameFilters = document.getElementById('frameFilters');

        document.querySelectorAll('.view-btn').forEach(btn => {
            if (!btn || !btn.dataset) return;
            btn.addEventListener('click', () => {
                document.querySelectorAll('.view-btn').forEach(b => {
                    if (b) b.classList.remove('active');
                });
                btn.classList.add('active');

                const view = btn.dataset.view;
                if (!view) return;
                framesSection.style.display = 'none';
                searchContainer.style.display = 'none';
                frameFilters.style.display = 'none';
                calculatorSection.style.display = 'none';
                adminSection.style.display = 'none';

                if (view === 'frames') {
                    framesSection.style.display = 'block';
                    searchContainer.style.display = 'block';
                    frameFilters.style.display = 'flex';
                } else if (view === 'calculator') {
                    calculatorSection.style.display = 'block';
                } else if (view === 'admin') {
                    adminSection.style.display = 'block';
                }
            });
        });

        // Calculator functionality
        const frameSelect = document.getElementById('frameSelect');
        const bandDisplay = document.getElementById('bandDisplay');
        const lengthInput = document.getElementById('lengthInput');
        const widthInput = document.getElementById('widthInput');
        const framePrice = document.getElementById('framePrice');
        const glassHeight = document.getElementById('glassHeight');
        const glassWidth = document.getElementById('glassWidth');
        const glassType = document.getElementById('glassType');
        const glassArea = document.getElementById('glassArea');
        const glassPrice = document.getElementById('glassPrice');
        const totalFrame = document.getElementById('totalFrame');
        const totalGlass = document.getElementById('totalGlass');
        const grandTotal = document.getElementById('grandTotal');

        let includeGlass = false;

        // Populate frame select dropdown (exclude backup-only frames)
        framesData.filter(f => !f.backupOnly).forEach(frame => {
            const band = priceBands[frame.code] || '?';
            const option = document.createElement('option');
            option.value = frame.code;
            option.textContent = `${frame.code} - ${frame.title} (Band ${band})`;
            frameSelect.appendChild(option);
        });

        // Glass toggle buttons
        document.querySelectorAll('.toggle-btn[data-glass]').forEach(btn => {
            if (!btn || !btn.dataset) return;
            btn.addEventListener('click', () => {
                document.querySelectorAll('.toggle-btn[data-glass]').forEach(b => {
                    if (b) b.classList.remove('active');
                });
                btn.classList.add('active');
                includeGlass = btn.dataset.glass === 'yes';
                calculateFramePrice();
            });
        });

        // Frame selection change
        frameSelect.addEventListener('change', () => {
            const code = frameSelect.value;
            const band = priceBands[code] || '-';
            bandDisplay.textContent = band;
            calculateFramePrice();
        });

        // Dimension inputs
        lengthInput.addEventListener('input', calculateFramePrice);
        widthInput.addEventListener('input', calculateFramePrice);

        // Glass inputs
        glassHeight.addEventListener('input', calculateGlassPrice);
        glassWidth.addEventListener('input', calculateGlassPrice);
        glassType.addEventListener('change', calculateGlassPrice);

        function calculateFramePrice() {
            const code = frameSelect.value;
            const band = priceBands[code];
            const length = parseFloat(lengthInput.value) || 0;
            const width = parseFloat(widthInput.value) || 0;

            if (!band || length <= 0 || width <= 0) {
                framePrice.textContent = '£0.00';
                totalFrame.textContent = '£0.00';
                updateGrandTotal();
                return;
            }

            // Calculate perimeter in meters
            const perimeterMeters = ((length * 2) + (width * 2)) / 100;

            // Band multipliers (from spreadsheet: A=6*5=30, B=9*5=45, C=12*5=60)
            const multipliers = { A: 30, B: 45, C: 60 };
            const multiplier = multipliers[band] || 30;

            let price = perimeterMeters * multiplier;

            // Add glass surcharge if selected
            if (includeGlass) {
                price += 50;
            }

            const priceFormatted = '£' + price.toFixed(2);
            framePrice.textContent = priceFormatted;
            totalFrame.textContent = priceFormatted;
            updateGrandTotal();
        }

        function calculateGlassPrice() {
            const height = parseFloat(glassHeight.value) || 0;
            const width = parseFloat(glassWidth.value) || 0;
            const ratePerCm2 = parseFloat(glassType.value) || 0;

            const area = height * width;
            glassArea.textContent = area.toFixed(0) + ' cm²';

            const price = area * ratePerCm2;
            const priceFormatted = '£' + price.toFixed(2);
            glassPrice.textContent = priceFormatted;
            totalGlass.textContent = priceFormatted;
            updateGrandTotal();
        }

        function updateGrandTotal() {
            const framePriceVal = parseFloat(framePrice.textContent.replace('£', '')) || 0;
            const glassPriceVal = parseFloat(glassPrice.textContent.replace('£', '')) || 0;
            const total = framePriceVal + glassPriceVal;
            grandTotal.textContent = '£' + total.toFixed(2);
        }

        // Reset button
        document.getElementById('resetCalc').addEventListener('click', () => {
            frameSelect.value = '';
            bandDisplay.textContent = '-';
            lengthInput.value = '';
            widthInput.value = '';
            glassHeight.value = '';
            glassWidth.value = '';
            glassType.value = '0';
            includeGlass = false;
            document.querySelectorAll('.toggle-btn[data-glass]').forEach(b => b.classList.remove('active'));
            document.querySelector('.toggle-btn[data-glass="no"]').classList.add('active');
            framePrice.textContent = '£0.00';
            glassArea.textContent = '0 cm²';
            glassPrice.textContent = '£0.00';
            totalFrame.textContent = '£0.00';
            totalGlass.textContent = '£0.00';
            grandTotal.textContent = '£0.00';
        });

        // PDF Export
        document.getElementById('exportPdf').addEventListener('click', () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const code = frameSelect.value;
            const frame = framesData.find(f => f.code === code);
            const band = priceBands[code] || '-';
            const length = lengthInput.value || '0';
            const width = widthInput.value || '0';
            const glassH = glassHeight.value || '0';
            const glassW = glassWidth.value || '0';
            const glassTypeText = glassType.options[glassType.selectedIndex].text;
            const framePriceVal = framePrice.textContent;
            const glassPriceVal = glassPrice.textContent;
            const totalVal = grandTotal.textContent;

            const today = new Date();
            const dateStr = today.toLocaleDateString('en-GB', {
                day: 'numeric', month: 'long', year: 'numeric'
            });
            const quoteNum = 'Q' + today.getFullYear() + String(today.getMonth() + 1).padStart(2, '0') + String(today.getDate()).padStart(2, '0') + String(Math.floor(Math.random() * 1000)).padStart(3, '0');

            // Header - Logo image
            const logoImg = document.getElementById('pdfLogo');
            if (logoImg && logoImg.complete) {
                try {
                    const canvas = document.createElement('canvas');
                    canvas.width = logoImg.naturalWidth;
                    canvas.height = logoImg.naturalHeight;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(logoImg, 0, 0);
                    const imgData = canvas.toDataURL('image/png');
                    doc.addImage(imgData, 'PNG', 20, 12, 80, 16);
                } catch(e) {
                    // Fallback to text
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(24);
                    doc.setTextColor(30, 30, 30);
                    doc.text('CASTLE FINE ART', 20, 25);
                }
            } else {
                // Fallback to text if image not loaded
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(24);
                doc.setTextColor(30, 30, 30);
                doc.text('CASTLE FINE ART', 20, 25);
            }

            // Quote info
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text('FRAMING QUOTE', 20, 35);
            doc.text(`Date: ${dateStr}`, 150, 20, { align: 'right' });
            doc.text(`Quote #: ${quoteNum}`, 150, 26, { align: 'right' });

            // Divider
            doc.setDrawColor(200, 200, 200);
            doc.line(20, 42, 190, 42);

            // Frame Details Section
            let y = 55;
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(30, 30, 30);
            doc.text('FRAME DETAILS', 20, y);

            y += 10;
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            doc.setTextColor(80, 80, 80);

            if (frame) {
                doc.text(`Frame Code:`, 20, y);
                doc.setTextColor(30, 30, 30);
                doc.text(code, 70, y);

                y += 7;
                doc.setTextColor(80, 80, 80);
                doc.text(`Frame Name:`, 20, y);
                doc.setTextColor(30, 30, 30);
                doc.text(frame.title, 70, y);

                y += 7;
                doc.setTextColor(80, 80, 80);
                doc.text(`Price Band:`, 20, y);
                doc.setTextColor(30, 30, 30);
                doc.text(`Band ${band}`, 70, y);

                y += 7;
                doc.setTextColor(80, 80, 80);
                doc.text(`Dimensions:`, 20, y);
                doc.setTextColor(30, 30, 30);
                doc.text(`${length} cm × ${width} cm`, 70, y);

                y += 7;
                doc.setTextColor(80, 80, 80);
                doc.text(`Standard Glass:`, 20, y);
                doc.setTextColor(30, 30, 30);
                doc.text(includeGlass ? 'Included (+£50)' : 'Not included', 70, y);
            } else {
                doc.text('No frame selected', 20, y);
            }

            // Glazing Section
            y += 20;
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(30, 30, 30);
            doc.text('GLAZING UPGRADE', 20, y);

            y += 10;
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);

            if (parseFloat(glassH) > 0 && parseFloat(glassW) > 0) {
                doc.setTextColor(80, 80, 80);
                doc.text(`Glass Size:`, 20, y);
                doc.setTextColor(30, 30, 30);
                doc.text(`${glassH} cm × ${glassW} cm`, 70, y);

                y += 7;
                doc.setTextColor(80, 80, 80);
                doc.text(`Glass Type:`, 20, y);
                doc.setTextColor(30, 30, 30);
                const shortGlassType = glassTypeText.split(' - ')[0];
                doc.text(shortGlassType, 70, y);

                y += 7;
                doc.setTextColor(80, 80, 80);
                doc.text(`Area:`, 20, y);
                doc.setTextColor(30, 30, 30);
                doc.text(glassArea.textContent, 70, y);
            } else {
                doc.setTextColor(80, 80, 80);
                doc.text('No glazing upgrade selected', 20, y);
            }

            // Price Breakdown
            y += 25;
            doc.setDrawColor(200, 200, 200);
            doc.line(20, y, 190, y);

            y += 15;
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(30, 30, 30);
            doc.text('PRICE BREAKDOWN', 20, y);

            y += 12;
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(11);

            // Frame price row
            doc.setTextColor(80, 80, 80);
            doc.text('Frame Price', 20, y);
            doc.setTextColor(30, 30, 30);
            doc.text(framePriceVal, 190, y, { align: 'right' });

            y += 8;
            doc.setTextColor(80, 80, 80);
            doc.text('Glazing Upgrade', 20, y);
            doc.setTextColor(30, 30, 30);
            doc.text(glassPriceVal, 190, y, { align: 'right' });

            // Total
            y += 5;
            doc.setDrawColor(30, 30, 30);
            doc.line(130, y, 190, y);

            y += 10;
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('TOTAL', 20, y);
            doc.text(totalVal, 190, y, { align: 'right' });

            // Footer
            y = 270;
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(120, 120, 120);
            doc.text('This quote is valid for 30 days from the date of issue.', 105, y, { align: 'center' });
            doc.text('Prices are estimates and may vary based on final specifications.', 105, y + 5, { align: 'center' });
            doc.text('Castle Fine Art | www.castlefineart.com', 105, y + 12, { align: 'center' });

            // Save the PDF
            const filename = code ? `CFA-Quote-${code}-${quoteNum}.pdf` : `CFA-Quote-${quoteNum}.pdf`;
            doc.save(filename);
        });

        // Admin functionality
        const adminLogin = document.getElementById('adminLogin');
        const adminPanel = document.getElementById('adminPanel');
        const adminPassword = document.getElementById('adminPassword');
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        const adminLogout = document.getElementById('adminLogout');
        const loginError = document.getElementById('loginError');
        const stockList = document.getElementById('stockList');

        let isAdminLoggedIn = sessionStorage.getItem('adminLoggedIn') === 'true';
        let adminSearchQuery = '';

        function showAdminPanel() {
            if (!adminLogin || !adminPanel) return;
            adminLogin.style.display = 'none';
            adminPanel.style.display = 'block';
            renderStockList();
        }

        function hideAdminPanel() {
            if (!adminLogin || !adminPanel) return;
            adminLogin.style.display = 'flex';
            adminPanel.style.display = 'none';
            if (adminPassword) adminPassword.value = '';
            if (loginError) loginError.style.display = 'none';
        }

        if (isAdminLoggedIn) {
            showAdminPanel();
        }

        adminLoginBtn.addEventListener('click', () => {
            if (adminPassword.value === ADMIN_PASSWORD) {
                isAdminLoggedIn = true;
                sessionStorage.setItem('adminLoggedIn', 'true');
                showAdminPanel();
            } else {
                loginError.style.display = 'block';
                adminPassword.value = '';
            }
        });

        adminPassword.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') adminLoginBtn.click();
        });

        adminLogout.addEventListener('click', () => {
            isAdminLoggedIn = false;
            sessionStorage.removeItem('adminLoggedIn');
            hideAdminPanel();
        });

        // Admin search functionality
        const adminSearchInput = document.getElementById('adminSearchInput');
        adminSearchInput.addEventListener('input', (e) => {
            adminSearchQuery = e.target.value.toLowerCase();
            renderStockList();
        });

        function renderStockList() {
            if (!stockList) return;
            // Only show non-backup frames in stock management
            let managedFrames = framesData.filter(f => !f.backupOnly);

            // Apply admin search filter
            if (adminSearchQuery) {
                managedFrames = managedFrames.filter(frame =>
                    frame.code.toLowerCase().includes(adminSearchQuery) ||
                    frame.title.toLowerCase().includes(adminSearchQuery) ||
                    frame.description.toLowerCase().includes(adminSearchQuery)
                );
            }

            if (managedFrames.length === 0) {
                stockList.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 2rem;">No frames found matching your search.</p>';
                return;
            }

            const calendarIcon = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>`;

            stockList.innerHTML = managedFrames.map(frame => {
                const outOfStock = isOutOfStock(frame.code);
                const restockDate = getRestockDate(frame.code);
                const isSlip = frame.isSlip;
                const imageUrl = frame.image ? frame.image : `${frame.code}_4.jpg`;
                return `
                    <div class="stock-item ${outOfStock ? 'out-of-stock' : ''}" data-code="${frame.code}">
                        <div class="stock-item-image">
                            <img src="${imageUrl}" alt="${frame.title}" onerror="this.style.display='none'">
                        </div>
                        <div class="stock-item-info">
                            <span class="stock-item-code">${frame.code}${isSlip ? ' <span style="color: #b8a8ff; font-size: 0.7rem;">(SLIP)</span>' : ''}</span>
                            <span class="stock-item-title">${frame.title}</span>
                        </div>
                        <div class="stock-item-controls">
                            <div class="restock-date-container ${outOfStock ? 'visible' : ''}" data-code="${frame.code}">
                                <input type="date" class="restock-input" data-code="${frame.code}" value="${restockDate}">
                                <button class="calendar-btn" data-code="${frame.code}" title="Set restock date">${calendarIcon}</button>
                                ${restockDate ? `<span class="restock-badge">${formatRestockDate(restockDate)}</span><button class="clear-date-btn" data-code="${frame.code}" title="Clear date">×</button>` : ''}
                            </div>
                            <div class="stock-toggle ${outOfStock ? 'out-of-stock' : 'in-stock'}"
                                 data-code="${frame.code}"
                                 title="${outOfStock ? 'Out of Stock - Click to mark In Stock' : 'In Stock - Click to mark Out of Stock'}">
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Add click handlers to toggles
            document.querySelectorAll('.stock-toggle').forEach(toggle => {
                if (!toggle || !toggle.dataset) return;
                toggle.addEventListener('click', () => {
                    const code = toggle.dataset.code;
                    if (!code) return;
                    const currentlyOut = isOutOfStock(code);

                    if (currentlyOut) {
                        delete stockStatus[code];
                        // Clear restock date when marking as in stock
                        setRestockDate(code, '');
                    } else {
                        stockStatus[code] = false;
                    }

                    saveStockStatus();
                    renderStockList();
                    renderFrames(framesData); // Refresh catalogue
                });
            });

            // Add change handlers to restock date inputs
            document.querySelectorAll('.restock-input').forEach(input => {
                if (!input || !input.dataset) return;
                input.addEventListener('change', () => {
                    const code = input.dataset.code;
                    if (!code) return;
                    setRestockDate(code, input.value);
                    renderStockList();
                    renderFrames(framesData); // Refresh catalogue to show updated date
                });
            });

            // Add click handlers to calendar buttons
            document.querySelectorAll('.calendar-btn').forEach(btn => {
                if (!btn || !btn.dataset) return;
                btn.addEventListener('click', () => {
                    const code = btn.dataset.code;
                    if (!code) return;
                    const input = document.querySelector(`.restock-input[data-code="${code}"]`);
                    if (input) {
                        input.showPicker();
                    }
                });
            });

            // Add click handlers to clear date buttons
            document.querySelectorAll('.clear-date-btn').forEach(btn => {
                if (!btn || !btn.dataset) return;
                btn.addEventListener('click', () => {
                    const code = btn.dataset.code;
                    if (!code) return;
                    setRestockDate(code, '');
                    renderStockList();
                    renderFrames(framesData);
                });
            });
        }
    </script>
</body>
</html>
